# 世界设定与模拟系统

## 1. 空间逻辑：磁贴与层级 (Tiles & Z-Levels)
- **3D 坐标系**: `Position(x, y, z)` 是世界的原子。
- **层级可见性 (Slicing)**: 
    - 渲染永远以玩家设置的 `DisplayZ` 为上限。
    - $Z > DisplayZ$: 剔除。
    - $Z < DisplayZ$: 变暗/模糊。
- **层间交互**: 允许跨层投射。例如：上层的光照会微弱地照射到下层露天区域。

## 2. 模拟组件 (Simulation Components)
- **`Brain`**: AI 的中枢，存储当前的 `Task` 和长期 `Personality`。
- **`PhysicalBody`**: 驱动 `Needs` 随逻辑 Tick 变化。
- **`Environment`**: 控制温度、湿度、肥沃度、氧气率等影响属性。

## 3. 生态与群落的演化 (Ecological Evolution)
### 涌现而非预设 (Emergence over Definition)
在 Colony 中，**生物群落（Biome）不是输入，而是输出**。程序员不预定义“沙漠种群”或“森林种群”，而是定义生物的生存规则：
- **资源限制**: 能量循环是核心，生物必须从环境中获取能量以抵消基础熵减（Metabolic Drain）。
- **自然选择**: 环境场（温度、湿度、养分）作为过滤器。只有基因（Genome）恰好适应局部环境的个体能成功繁殖。
- **演化聚簇**: 随着时间推移，在特定环境区域内存活的优势基因群体，在视觉和行为上形成我们观察到的“群落”。

### 环境场 (Environmental Fields)
世界由叠加的、动态变化的“环境属性场”组成：
- **温度 (Temperature)**: 影响代谢速率，作为生存门槛。
- **湿度 (Humidity)**: 影响植物产氧/产肉效率。
- **肥沃度 (Fertility)**: 作为磁贴的“养分池”，被生物抽取，随分解反馈。

## 4. 生物设计：基因组驱动 (Genome-Driven Design)
### 基因组组件 (`Genome`)
生物不再由物种模板定义，而是由一组连续的、可变异的核心参数决定表现型：
- **物理性状**: 大小 (Size)、感知力 (Sensory Range)、移动力 (Speed)。
- **代谢策略**: 营养获取方式（光合/肉食/杂食）、基础代谢代价。
- **行为倾向**: 对不同驱动（饥饿、恐惧、群居）的反应灵敏度。

### 生命周期与反馈
- **遗传变异**: 后代继承双亲（或单亲）的 `Genome` 时产生微小偏移，允许跨代适应。
- **环境塑造**: 例如大量草食生物聚集会导致地表退化（Grass -> Dirt），从而改变该处的环境场属性，迫使该种群迁徙或发生进化变异。

## 5. 系统交互流程 (System Orchestration)
1. **Simulation Tick (固定 4-10 Hz)**:
    - 能量熵减系统: 根据 `Genome` 和当前环境计算所有实体的能量损耗。
    - 环境演化系统: 更新肥沃度回复、热量传导等物理属性。
2. **决策评估与变异 (Evaluation & Mutation)**:
    - 生物根据基因决定的权重进行决策。
    - 能量充足个体通过 `Mutation` 生成新后代。
3. **任务系统 (Execution)**:
    - 演化出的行为模式（如捕食、储粮）在任务层执行。
4. **Rendering Update**:
    - 视觉表现（颜色、体型）直接根据 `Genome` 参数进行映射。
